uniq <- getUniqueTrialsNormal(
  scenario_list = scenario_list_normal,
  nbins         = 4   # or whatever you used
)

str(uniq)           # just to see the structure
uniq$groups         # group_id, rep_scenario, rep_trial, n_members
uniq$map            # scenario_index, trial_index, group_id, signature
uniq$breaks         # bin boundaries per cohort

means_list <- list()
scen_idx   <- integer(0)
trial_idx  <- integer(0)

for (s in seq_along(scenario_list_normal)) {
  trials <- scenario_list_normal[[s]]$trials
  
  for (t in seq_along(trials)) {
    y_list <- trials[[t]]$y_list
    
    # mean per cohort in this trial
    m <- vapply(y_list, mean, numeric(1))
    
    means_list[[length(means_list) + 1L]] <- m
    scen_idx  <- c(scen_idx, s)
    trial_idx <- c(trial_idx, t)
  }
}

all_cohorts <- unique(unlist(lapply(means_list, names), use.names = FALSE))

means_mat <- t(vapply(means_list, function(v) {
  out <- rep(NA_real_, length(all_cohorts))
  names(out) <- all_cohorts
  out[names(v)] <- v
  out
}, numeric(length(all_cohorts))))

colnames(means_mat) <- all_cohorts

head(means_mat)
head(cbind(scenario_index = scen_idx,
           trial_index    = trial_idx,
           means_mat))

debug_df <- data.frame(
  scenario_index = scen_idx,
  trial_index    = trial_idx,
  means_mat,
  group_id  = uniq$map$group_id,
  signature = uniq$map$signature,
  stringsAsFactors = FALSE
)

# Look at first 10 rows
head(debug_df, 10)

debug_df[debug_df$group_id == 2, ]

uniq$breaks  # list per cohort

uniq$breaks$c_1  # breaks for cohort c_1
uniq$breaks$c_2  # breaks for cohort c_2

row_i <- debug_df[debug_df$group_id == 2, ][1, ]

row_i$c_1
uniq$breaks$c_1
row_i$c_2
uniq$breaks$c_2

