performAnalysesNormal <- function(
  scenario_list,
  evidence_levels        = c(0.025, 0.05, 0.5, 0.8, 0.9, 0.95, 0.975),
  calc_differences       = NULL,
  n_mcmc_iterations      = 1e4,
  prior_parameters_normal= NULL,
  verbose                = TRUE
) {
  error_scenario_list <- simpleError(
    "Please provide an object of class 'scenario_list_normal' for 'scenario_list'")
  error_evidence_levels <- simpleError(
    "Please provide a vector of numerics in (0, 1) for the argument 'evidence_levels'")
  error_n_mcmc_iterations <- simpleError(
    "Please provide a positive integer for the argument 'n_mcmc_iterations'")
  error_verbose <- simpleError(
    "Please provide a logical for the argument 'verbose'")

  if (missing(scenario_list)) stop(error_scenario_list)
  if (!is.scenario_list_normal(scenario_list)) stop(error_scenario_list)

  if (!is.numeric.in.zero.one(evidence_levels)) stop(error_evidence_levels)
  if (!is.single.positive.wholenumber(n_mcmc_iterations)) stop(error_n_mcmc_iterations)
  if (!is.logical(verbose) || length(verbose) != 1L) stop(error_verbose)

  if (!is.null(calc_differences)) {
    calc_differences <- convertVector2Matrix(calc_differences)
  }

  ## build quantiles in the same style as binary performAnalyses
  quantiles <- sort(unique(round(
    1 - c(0.025, 0.05, 0.5, 0.8, 0.9, 0.95, 0.975, evidence_levels),
    9
  )))

  ## prior + JAGS model prep
  if (is.null(prior_parameters_normal)) {
    prior_parameters_normal <- getPriorParametersNormal()
  }

  prep         <- prepareAnalysisNormal(prior_parameters = prior_parameters_normal)
  j_parameters <- prep$j_parameters
  j_model_file <- prep$j_model_file
  j_data_fixed <- prep$j_data

  ## get scenario numbers
  scenario_numbers <- sapply(scenario_list, function(x) x$scenario_number)

  ## collect n_subjects across scenarios
  all_scenarios_n_subjects <- do.call(
    rbind,
    lapply(scenario_list, function(x) x$n_subjects)
  )

  ## overall go flags from previous analyses, or TRUE if no previous analyses
  all_scenarios_overall_gos <- do.call(
    rbind,
    lapply(scenario_list, function(x) {
      if (!is.null(x$previous_analyses$post_quantiles)) {
        x$previous_analyses$go_decisions
      } else {
        matrix(TRUE, nrow = nrow(x$n_subjects), ncol = 1)
      }
    })
  )[, 1]

  ## unique trials (n_subjects + go flag)
  trials_unique <- getUniqueTrialsNormal(
    n_subjects_matrix = all_scenarios_n_subjects,
    go_flag           = all_scenarios_overall_gos
  )

  n_cohorts <- ncol(trials_unique) - 1L

  ## can we reuse previous analyses?
  applicable_previous_trials <- applicablePreviousTrialsNormal(
    scenario_list    = scenario_list,
    quantiles        = quantiles,
    n_cohorts        = n_cohorts,
    calc_differences = calc_differences
  )

  if (applicable_previous_trials) {
    calc_trial_indices <- trials_unique[, ncol(trials_unique)] > 0
  } else {
    calc_trial_indices <- rep(TRUE, nrow(trials_unique))
  }

  trials_unique_calc <- trials_unique[calc_trial_indices, , drop = FALSE]
  n_subjects_unique  <- trials_unique_calc[, seq_len(n_cohorts), drop = FALSE]

  if (verbose) {
    message(
      format(Sys.time(), "%d-%b-%Y"),
      " Performing Analyses (normal endpoint)"
    )
    message(
      "   Analyzing ",
      length(scenario_numbers), " scenario",
      ifelse(length(scenario_numbers) == 1, "", "s"),
      " (", nrow(n_subjects_unique), " unique trial realization",
      ifelse(nrow(n_subjects_unique) == 1, "", "s"), ")"
    )
  }

  ## run JAGS for each unique trial via helper
  if (verbose) {
    start_time <- Sys.time()
    message("   Running bhm_normal model ...")
  }

  method_quantiles_list <- getPostQuantilesNormal(
    quantiles         = quantiles,
    scenario_list     = scenario_list,
    n_subjects_unique = n_subjects_unique,
    calc_differences  = calc_differences,
    j_parameters      = j_parameters,
    j_model_file      = j_model_file,
    j_data_fixed      = j_data_fixed,
    n_mcmc_iterations = n_mcmc_iterations
  )

  if (verbose) {
    message(
      "       finished after ",
      round(Sys.time() - start_time, 1), " ",
      units(Sys.time() - start_time), "."
    )
  }

  ## map back to scenarios
  if (verbose) {
    start_time <- Sys.time()
    message("   Processing scenarios ...")
  }

  scenario_method_quantiles_list <- mapUniqueTrialsNormal(
    scenario_list              = scenario_list,
    method_quantiles_list      = method_quantiles_list,
    trials_unique_calc         = trials_unique_calc,
    applicable_previous_trials = applicable_previous_trials
  )

  if (verbose) {
    message(
      "       finished after ",
      round(Sys.time() - start_time, 1), " ",
      units(Sys.time() - start_time), "."
    )
  }

  ## build output
  analyses_list        <- vector("list", length(scenario_numbers))
  names(analyses_list) <- paste0("scenario_", scenario_numbers)

  for (s in seq_along(scenario_numbers)) {
    analyses_list[[s]] <- list(
      quantiles_list      = list(normal = scenario_method_quantiles_list[[s]]),
      scenario_data       = scenario_list[[s]],
      analysis_parameters = list(
        quantiles               = quantiles,
        evidence_levels         = evidence_levels,
        method_names            = "normal",
        prior_parameters_normal = prior_parameters_normal,
        n_mcmc_iterations       = n_mcmc_iterations
      )
    )
  }

  class(analyses_list) <- "analysis_list_normal"
  analyses_list
}
