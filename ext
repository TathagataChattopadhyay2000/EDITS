simulateScenariosNormal <- function(
  n_control_list,
  n_treatment_list,
  mean_control_list,
  mean_treatment_list,
  sd,
  scenario_numbers = seq_along(mean_control_list),
  n_trials         = 1e4
) {
  error_n_control_list  <- simpleError(
    "Please provide a list of vectors of positive integers for 'n_control_list'")
  error_n_treatment_list  <- simpleError(
    "Please provide a list of vectors of positive integers for 'n_treatment_list'")
  error_mean_list <- simpleError(
    "Please provide lists of numeric vectors for 'mean_control_list' and 'mean_treatment_list'")
  error_sd <- simpleError(
    "Please provide a single positive numeric value for 'sd'")
  error_n_trials <- simpleError(
    "Please provide a positive integer for 'n_trials'")
  error_scenario_numbers <- simpleError(
    "Please provide a vector of positive integers for 'scenario_numbers'")

  if (missing(n_control_list))    stop(error_n_control_list)
  if (missing(n_treatment_list))  stop(error_n_treatment_list)
  if (missing(mean_control_list) || missing(mean_treatment_list)) stop(error_mean_list)
  if (missing(sd))                stop(error_sd)

  if (!is.list(n_control_list) ||
      any(!sapply(n_control_list, is.positive.wholenumber)))
    stop(error_n_control_list)
  if (!is.list(n_treatment_list) ||
      any(!sapply(n_treatment_list, is.positive.wholenumber)))
    stop(error_n_treatment_list)

  if (!is.list(mean_control_list) ||
      any(!sapply(mean_control_list, is.numeric)) ||
      !is.list(mean_treatment_list) ||
      any(!sapply(mean_treatment_list, is.numeric)))
    stop(error_mean_list)

  if (!identical(length(n_control_list), length(n_treatment_list)) ||
      !identical(length(n_control_list), length(mean_control_list)) ||
      !identical(length(n_control_list), length(mean_treatment_list)))
    stop(simpleError(
      "'n_control_list', 'n_treatment_list', 'mean_control_list', 'mean_treatment_list' must have same length"
    ))

  # within each scenario: same number of cohorts and consistent lengths
  if (any(!sapply(seq_along(n_control_list), function(s) {
    length(n_control_list[[s]])      == length(n_treatment_list[[s]]) &&
    length(n_control_list[[s]])      == length(mean_control_list[[s]]) &&
    length(n_control_list[[s]])      == length(mean_treatment_list[[s]])
  })))
    stop(simpleError(
      "Within each scenario, vectors in n_control_list, n_treatment_list, mean_control_list, mean_treatment_list must all have the same length"
    ))

  if (!is.single.numeric(sd) || sd <= 0) stop(error_sd)

  if ("n_trials" %in% ls(envir = .GlobalEnv) & missing(n_trials)) {
    n_trials <- get("n_trials", envir = .GlobalEnv)
  }
  if (!is.single.positive.wholenumber(n_trials)) stop(error_n_trials)

  if (!is.positive.wholenumber(scenario_numbers)) stop(error_scenario_numbers)
  if (!identical(length(scenario_numbers), length(n_control_list))) stop(simpleError(
    "'scenario_numbers' and 'n_control_list' must have same length"
  ))

  scenario_list <- vector("list", length(scenario_numbers))

  for (s in seq_along(scenario_numbers)) {
    scenario_list[[s]] <- getScenarioNormal(
      n_control      = n_control_list[[s]],
      n_treatment    = n_treatment_list[[s]],
      mean_control   = mean_control_list[[s]],
      mean_treatment = mean_treatment_list[[s]],
      cohort_names   = seq_along(n_control_list[[s]]),
      sd             = sd,
      n_trials       = n_trials
    )
    scenario_list[[s]]$scenario_number <- scenario_numbers[s]
  }

  names(scenario_list) <- paste0("scenario_", scenario_numbers)
  class(scenario_list) <- "scenario_list_normal"

  return(scenario_list)
}


simulateScenariosNormal <- function(
  n_control_list,
  n_treatment_list,
  mean_control_list,
  mean_treatment_list,
  sd,
  scenario_numbers = seq_along(mean_control_list),
  n_trials         = 1e4
) {
  error_n_control_list  <- simpleError(
    "Please provide a list of vectors of positive integers for 'n_control_list'")
  error_n_treatment_list  <- simpleError(
    "Please provide a list of vectors of positive integers for 'n_treatment_list'")
  error_mean_list <- simpleError(
    "Please provide lists of numeric vectors for 'mean_control_list' and 'mean_treatment_list'")
  error_sd <- simpleError(
    "Please provide a single positive numeric value for 'sd'")
  error_n_trials <- simpleError(
    "Please provide a positive integer for 'n_trials'")
  error_scenario_numbers <- simpleError(
    "Please provide a vector of positive integers for 'scenario_numbers'")

  if (missing(n_control_list))    stop(error_n_control_list)
  if (missing(n_treatment_list))  stop(error_n_treatment_list)
  if (missing(mean_control_list) || missing(mean_treatment_list)) stop(error_mean_list)
  if (missing(sd))                stop(error_sd)

  if (!is.list(n_control_list) ||
      any(!sapply(n_control_list, is.positive.wholenumber)))
    stop(error_n_control_list)
  if (!is.list(n_treatment_list) ||
      any(!sapply(n_treatment_list, is.positive.wholenumber)))
    stop(error_n_treatment_list)

  if (!is.list(mean_control_list) ||
      any(!sapply(mean_control_list, is.numeric)) ||
      !is.list(mean_treatment_list) ||
      any(!sapply(mean_treatment_list, is.numeric)))
    stop(error_mean_list)

  if (!identical(length(n_control_list), length(n_treatment_list)) ||
      !identical(length(n_control_list), length(mean_control_list)) ||
      !identical(length(n_control_list), length(mean_treatment_list)))
    stop(simpleError(
      "'n_control_list', 'n_treatment_list', 'mean_control_list', 'mean_treatment_list' must have same length"
    ))

  # within each scenario: same number of cohorts and consistent lengths
  if (any(!sapply(seq_along(n_control_list), function(s) {
    length(n_control_list[[s]])      == length(n_treatment_list[[s]]) &&
    length(n_control_list[[s]])      == length(mean_control_list[[s]]) &&
    length(n_control_list[[s]])      == length(mean_treatment_list[[s]])
  })))
    stop(simpleError(
      "Within each scenario, vectors in n_control_list, n_treatment_list, mean_control_list, mean_treatment_list must all have the same length"
    ))

  if (!is.single.numeric(sd) || sd <= 0) stop(error_sd)

  if ("n_trials" %in% ls(envir = .GlobalEnv) & missing(n_trials)) {
    n_trials <- get("n_trials", envir = .GlobalEnv)
  }
  if (!is.single.positive.wholenumber(n_trials)) stop(error_n_trials)

  if (!is.positive.wholenumber(scenario_numbers)) stop(error_scenario_numbers)
  if (!identical(length(scenario_numbers), length(n_control_list))) stop(simpleError(
    "'scenario_numbers' and 'n_control_list' must have same length"
  ))

  scenario_list <- vector("list", length(scenario_numbers))

  for (s in seq_along(scenario_numbers)) {
    scenario_list[[s]] <- getScenarioNormal(
      n_control      = n_control_list[[s]],
      n_treatment    = n_treatment_list[[s]],
      mean_control   = mean_control_list[[s]],
      mean_treatment = mean_treatment_list[[s]],
      cohort_names   = seq_along(n_control_list[[s]]),
      sd             = sd,
      n_trials       = n_trials
    )
    scenario_list[[s]]$scenario_number <- scenario_numbers[s]
  }

  names(scenario_list) <- paste0("scenario_", scenario_numbers)
  class(scenario_list) <- "scenario_list_normal"

  return(scenario_list)
}

