saveScenariosNormal <- function(
  scenario_list,
  save_path = tempdir()
) {

  if (missing(scenario_list))
    stop("Please provide an object of class 'scenario_list_normal' for the argument 'scenario_list'")

  if (!inherits(scenario_list, "scenario_list_normal"))
    stop("Please provide an object of class 'scenario_list_normal' for the argument 'scenario_list'")

  if (!is.character(save_path) || length(save_path) > 1)
    stop("Please provide a string for the argument 'save_path'")

  if (!dir.exists(save_path)) {
    dir.create(save_path)
  }

  scenario_numbers <- sapply(scenario_list, function(x) x$scenario_number)

  for (s in seq_along(scenario_list)) {
    saveRDS(
      scenario_list[[s]],
      file = file.path(save_path, paste0("scenario_data_", scenario_numbers[s], ".rds"))
    )
  }

  return(list(scenario_numbers = scenario_numbers, path = save_path))
}

loadScenariosNormal <- function(
  scenario_numbers,
  load_path = tempdir()
) {

  if (missing(scenario_numbers))
    stop("Please provide a vector of positive integers for the argument 'scenario_numbers'")

  if (!is.numeric(scenario_numbers) ||
      !is.wholenumber(scenario_numbers) ||
      any(scenario_numbers <= 0))
    stop("Please provide a vector of positive integers for the argument 'scenario_numbers'")

  if (!is.character(load_path) || length(load_path) > 1)
    stop("Please provide a string for the argument 'load_path'")

  scenario_list <- vector("list", length(scenario_numbers))

  for (s in seq_along(scenario_numbers)) {
    scenario_list[[s]] <- readRDS(
      file.path(load_path, paste0("scenario_data_", scenario_numbers[s], ".rds"))
    )
  }

  names(scenario_list) <- paste0("scenario_", scenario_numbers)
  class(scenario_list) <- "scenario_list_normal"

  return(scenario_list)
}

print.scenario_list_normal <- function(x, ...) {

  n_scenarios    <- length(x)
  scenario_names <- names(x)

  K <- length(x[[1]]$true_means_control)
  cohort_names <- paste0("c_", seq_len(K))

  true_means_control   <- lapply(x, function(z) z$true_means_control)
  true_means_treatment <- lapply(x, function(z) z$true_means_treatment)
  n_subjects           <- getAverageNSubjects(x)

  n_trial_realizations  <- x[[1]]$n_trials
  n_unique_realizations <- nrow(getUniqueTrials(x))

  cat("scenario_list_normal of ", n_scenarios, " scenario",
      ifelse(n_scenarios == 1, "", "s"),
      " with ", K, " cohort", ifelse(K == 1, "", "s"), "\n\n", sep = "")

  for (n in seq_along(scenario_names)) {

    df_out <- rbind(
      `    - true control means:`    = true_means_control[[n]],
      `    - true treatment means:`  = true_means_treatment[[n]],
      `    - average number of subjects:` = n_subjects[[n]]
    )

    colnames(df_out) <- cohort_names

    cat("  -", scenario_names[n], "\n")
    print(df_out)
    cat("\n")
  }

  cat("  -", n_trial_realizations,  "trial realizations per scenario\n")
  cat("  -", n_unique_realizations, "unique trial realizations overall\n")
}
