## 8. Semantics: overall_min_gos in a simple way -------------------------------

test_that("overall_min_gos = 1 means overall Go if at least one cohort is Go", {

  dec <- getGoDecisions(
    analyses_list   = analyses_list,
    cohort_names    = default_cohorts,
    evidence_levels = rep(0.5, length(default_cohorts)),
    boundary_rules  = quote(c(TRUE, TRUE, TRUE)),  # simple always-true rule
    overall_min_gos = 1L
  )

  m <- as.matrix(dec[[1]]$decisions_list[[1]])

  # All columns except 'overall' are cohort-level decisions.
  coh_cols <- setdiff(colnames(m), "overall")
  expect_true(length(coh_cols) >= 1)

  coh <- m[, coh_cols, drop = FALSE] > 0   # logical matrix of cohort decisions

  # Definition: overall is TRUE if at least one cohort is TRUE.
  overall_calc <- apply(coh, 1, function(x) sum(x) >= 1L)

  overall <- as.logical(m[, "overall"])
  expect_identical(overall, overall_calc)
})


test_that("overall_min_gos = 2 means overall Go if at least two cohorts are Go", {

  dec <- getGoDecisions(
    analyses_list   = analyses_list,
    cohort_names    = default_cohorts,
    evidence_levels = rep(0.5, length(default_cohorts)),
    boundary_rules  = quote(c(TRUE, TRUE, TRUE)),
    overall_min_gos = 2L
  )

  m <- as.matrix(dec[[1]]$decisions_list[[1]])

  coh_cols <- setdiff(colnames(m), "overall")
  expect_true(length(coh_cols) >= 1)

  coh <- m[, coh_cols, drop = FALSE] > 0

  # Definition: overall is TRUE if at least two cohorts are TRUE.
  overall_calc <- apply(coh, 1, function(x) sum(x) >= 2L)

  overall <- as.logical(m[, "overall"])
  expect_identical(overall, overall_calc)
})
