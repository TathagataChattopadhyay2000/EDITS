#' Simulate scenarios with a continuous (normal) endpoint
#'
#' This is analogous to simulateScenarios(), but instead of binary responses
#' it simulates continuous outcomes y ~ Normal(mean_j, sd^2) per cohort.
#'
#' @param n_subjects_list list of integer vectors; per scenario, number of
#'   subjects in each cohort.
#' @param mean_list list of numeric vectors; per scenario, true mean in each
#'   cohort (same length as corresponding n_subjects_list element).
#' @param sd positive numeric; common standard deviation of the endpoint.
#' @param scenario_numbers integer vector of scenario labels.
#' @param n_trials number of simulated trials per scenario.
#' @return a list of scenarios of class "scenario_list_normal".
simulateScenariosNormal <- function(
  n_subjects_list,
  mean_list,
  sd,
  scenario_numbers = seq_along(mean_list),
  n_trials = 1000
) {
  # Basic checks (kept light so we don't depend on internal helpers)
  if (!is.list(n_subjects_list)) {
    stop("'n_subjects_list' must be a list of integer vectors.")
  }
  if (!is.list(mean_list)) {
    stop("'mean_list' must be a list of numeric vectors.")
  }
  if (length(n_subjects_list) != length(mean_list)) {
    stop("'n_subjects_list' and 'mean_list' must have the same length.")
  }
  if (length(scenario_numbers) != length(mean_list)) {
    stop("'scenario_numbers' must have same length as 'mean_list'.")
  }
  if (!is.numeric(sd) || length(sd) != 1L || sd <= 0) {
    stop("'sd' must be a single positive numeric value.")
  }

  n_scen <- length(mean_list)
  scenario_list <- vector("list", n_scen)

  for (s in seq_len(n_scen)) {
    n_subj <- n_subjects_list[[s]]
    means  <- mean_list[[s]]

    if (length(n_subj) != length(means)) {
      stop(sprintf(
        "In scenario %d, lengths of n_subjects_list and mean_list differ.",
        scenario_numbers[s]
      ))
    }

    J      <- length(n_subj)
    max_n  <- max(n_subj)

    # trials[[t]]$y: matrix [max_n x J] of outcomes for trial t
    trials <- vector("list", n_trials)

    for (t in seq_len(n_trials)) {
      y_mat <- matrix(NA_real_, nrow = max_n, ncol = J)
      for (j in seq_len(J)) {
        y_mat[seq_len(n_subj[j]), j] <-
          stats::rnorm(n_subj[j], mean = means[j], sd = sd)
      }
      colnames(y_mat) <- paste0("y_", seq_len(J))

      trials[[t]] <- list(
        y          = y_mat,
        n_subjects = n_subj
      )
    }

    scenario_list[[s]] <- list(
      scenario_number = scenario_numbers[s],
      trials          = trials,
      true_means      = means,
      sd              = sd
    )
  }

  names(scenario_list) <- paste0("scenario_", scenario_numbers)
  class(scenario_list) <- "scenario_list_normal"
  scenario_list
}
